<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>VitroIO SDK: vitro-shard-sdk</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">VitroIO SDK
   </div>
   <div id="projectbrief">Software development kit for Vitro Shard.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">vitro-shard-sdk </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><a class="anchor" id="md_README"></a></p>
<ul>
<li>vitro-shard-sdk<ul>
<li>Introduction</li>
<li>Features</li>
<li>Dependencies</li>
<li>Usage</li>
<li>Architecture<ul>
<li>Division into modules</li>
<li>Event queues and callbacks</li>
</ul>
</li>
<li>Typical cooperation of objects</li>
<li>Closed source static library<ul>
<li>Building</li>
<li>Using</li>
<li>Known issues</li>
</ul>
</li>
<li>Releasing SDK</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md1"></a>
Introduction</h1>
<p ><code>vitro-shard-sdk</code> is a library based on <a href="https://www.mbed.com/en/platform/mbed-os/">mbed-os</a> designed for developers of <code>vitroio</code> nodes firmware.</p>
<p >The library provides common nodes functionality and handles standard communication protocol with gateway i.e. initialization of communication and firmware upgrade.</p>
<p >For detailed guideline for firmware developers and examples please see firmware developers guide.</p>
<p >For detailed API documentation please see doc.</p>
<h1><a class="anchor" id="autotoc_md2"></a>
Features</h1>
<ul>
<li><p class="startli"><b>Simple communication over bus</b></p>
<p class="startli">The library provides classes for bus frames and CAN bus with interfaces complied with defined communication protocol. The user has not to care about formatting the frame identifier. Provided type for bus frames allows to set particular element of the frame and the abstraction layer for CAN bus allows for directly sending/receiving of such frames.</p>
</li>
<li><p class="startli"><b>Handling predefined communication protocol</b></p>
<p class="startli">The <code>NodeController</code> class hides predefined communication protocol from user. The user is not responsible for handling predefined bus frames e.g. initialization of communication with gateway, reporting firmware version etc. The <code>NodeController</code> class provides appropriate methods for such operations e.g. <code>initCommunication</code>, which cares about the whole process.</p>
</li>
<li><p class="startli"><b>Firmware upgrades support</b></p>
<p class="startli">The upgrade of the firmware also belongs to predefined communication protocol. Therefore, all of the user has to do is to create <code>NodeController</code> object and initialize the communication with gateway to provide support for firmware upgrades. When the new firmware is available in the flash memory, the application will be reset automatically.</p>
</li>
<li><p class="startli"><b>Easy implementation of measurement system</b></p>
<p class="startli">The <code>sdk</code> provides classes for easy construction of measurement system based on sensors chosen by the user. Developer has to implement <code>AbstractSensorDriver</code> and <code>AbstractSensorInterface</code> virtual classes to provide support of its sensors. Then, all to do is to create <code>MeasurementApi</code> object and configure it i.e. register implemented sensors interfaces, set polling time and set handler for measurement values. The <code>MeasurementApi</code> reads measurement parameters from all of registered sensors in set intervals and calls registered handler when the new values are read.</p>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md3"></a>
Dependencies</h1>
<p >The library requires <code>mbedOS</code> version <code>6.16.0</code></p>
<h1><a class="anchor" id="autotoc_md4"></a>
Usage</h1>
<ul>
<li><p class="startli">To the project sources should be included root directory of <code>vitro-shard-sdk</code> repository.</p>
<p class="startli">All of library sources are placed in <code>vitroio-sdk</code> directory. Therefore headers should be included in user application with <code>vitroio-sdk</code> prefix. For example: </p><div class="fragment"><div class="line">#include &lt;vitroio-sdk/communication/canbus.h&gt;</div>
</div><!-- fragment --></li>
<li>All of library components are placed in <code><a class="el" href="d4/dc7/namespacevitroio_1_1sdk.html" title="The namespace contains all of components defined by vitro-shard-sdk.">vitroio::sdk</a></code> namespace.</li>
<li>Classes placed in <code>impl</code> directories of modules folders should not be used in user application. Additionaly these components are also placed in <code>impl</code> namespace.</li>
</ul>
<h1><a class="anchor" id="autotoc_md5"></a>
Architecture</h1>
<h2><a class="anchor" id="autotoc_md6"></a>
Division into modules</h2>
<p >The <code>sdk</code> is divided into functional modules. It allows to disable compilation of particular modules using <code>.mbedignore</code> file. However, some modules can require another ones for internal usage. For more information see detailed documentation.</p>
<h2><a class="anchor" id="autotoc_md7"></a>
Event queues and callbacks</h2>
<p >All of modules which do some real time stuff, operate on an event queue. The user can choose if an object is to use external or internal event queue. However, on both cases the internal event queue is created but it is chained into external queue or handled by internal thread respectively. Priority of internal thread and size of internal queue determines the user. For more information about event queues of mbed please see <a href="https://os.mbed.com/docs/mbed-os/v6.15/apis/scheduling-tutorials.html">About the mbed OS event loop</a>.</p>
<p >All of events that the particular object can generate are handled by callbacks registered by the user.</p>
<h1><a class="anchor" id="autotoc_md8"></a>
Typical cooperation of objects</h1>
<p >Typical cooperation of objects is presented in below scheme:</p>
<p ><img src="./images/typical_cooperation_of_objects.png" alt="" class="inline"/></p>
<h1><a class="anchor" id="autotoc_md9"></a>
Closed source static library</h1>
<p >Since 1.2.1 version it is possible to build closed-source Vitro Shard SDK as static library.</p>
<h2><a class="anchor" id="autotoc_md10"></a>
Building</h2>
<p >Make sure to run <code>git submodule update --init --recursive</code> before building Build using <code>./docker_build_lib.sh</code> script. Output library and header files will be available in <code>Vitro-SDK-Lib</code> directory.</p>
<h3><a class="anchor" id="autotoc_md11"></a>
Library info</h3>
<p >If you've made manual changes to the sdk code and compiled it, but aren't seeing your changes, try to copy the compiled product like this:</p>
<ul>
<li>first copy the two files, <code>libvitro-shard-sdkx.y.z.a</code> and <code><a class="el" href="d4/d3e/shard-sdk_8h.html">shard-sdk.h</a></code> to your desired location.</li>
<li>then, instead of copying the <code>Vitro-SDK-Lib/vitroio-sdk</code> folder, copy the <code>vitroio-sdk</code> folder directly from the <code>vitro-shard-sdk</code> repo.</li>
</ul>
<h2><a class="anchor" id="autotoc_md12"></a>
Using</h2>
<p >Copy static library and header files from <code>Vitro-SDK-Lib</code> to directory with source code of your project.</p>
<h2><a class="anchor" id="autotoc_md13"></a>
Known issues</h2>
<blockquote class="doxtable">
<p >&zwj;NOTE: There is a few differences in SDK older than 2.0.0. Change branch to </p>
</blockquote>
<p>see old guides</p>
<ul>
<li>To compile properly, application should be builded with mbed taken from commit <a href="https://github.com/ARMmbed/mbed-os/commit/54e8693ef4ff7e025018094f290a1d5cf380941f">#54e8693ef4ff7e025018094f290a1d5cf380941f</a> (mbedOS release 6.16)</li>
<li>When including files to your application, <code>mbed.h</code> has to be included before <code><a class="el" href="d4/d3e/shard-sdk_8h.html">shard-sdk.h</a></code>.</li>
<li><p class="startli">User application should contain object of type <code>BufferedSerial</code> named <code>pc</code> and console override handler defined simmiliar to this:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define SERIAL_BAUDRATE 115200</span></div>
<div class="line">BufferedSerial pc(<a class="code hl_define" href="d8/db5/consts_8h.html#a7dc4d3c455fac095b4812a64808ebb8f">UART_DEBUG_TX</a>, <a class="code hl_define" href="d8/db5/consts_8h.html#a7cc3b7bc5e0bbe103b1dfe650fcfec2f">UART_DEBUG_RX</a>, SERIAL_BAUDRATE);</div>
<div class="line"> </div>
<div class="line">FileHandle *mbed::mbed_override_console(<span class="keywordtype">int</span> fd)</div>
<div class="line">{</div>
<div class="line">   <span class="keywordflow">return</span> &amp;pc;</div>
<div class="line">}</div>
<div class="ttc" id="aconsts_8h_html_a7cc3b7bc5e0bbe103b1dfe650fcfec2f"><div class="ttname"><a href="d8/db5/consts_8h.html#a7cc3b7bc5e0bbe103b1dfe650fcfec2f">UART_DEBUG_RX</a></div><div class="ttdeci">#define UART_DEBUG_RX</div><div class="ttdef"><b>Definition:</b> consts.h:35</div></div>
<div class="ttc" id="aconsts_8h_html_a7dc4d3c455fac095b4812a64808ebb8f"><div class="ttname"><a href="d8/db5/consts_8h.html#a7dc4d3c455fac095b4812a64808ebb8f">UART_DEBUG_TX</a></div><div class="ttdeci">#define UART_DEBUG_TX</div><div class="ttdef"><b>Definition:</b> consts.h:34</div></div>
</div><!-- fragment --></li>
</ul>
<p >This serial port is used for application console.</p>
<h1><a class="anchor" id="autotoc_md14"></a>
Releasing SDK</h1>
<p >To release the SDK from private repo to the public - take the following steps:</p>
<ol type="1">
<li>Introduce the changes to CHANGELOG.md in the private repository.</li>
</ol>
<blockquote class="doxtable">
<p >&zwj;<b>Warning!!</b> Make sure no sensitive information is provided in the release notes or changelog. These changes will be copied over to public CHANGELOG.md repo. </p>
</blockquote>
<ol type="1">
<li>Create a temp release branch and commit your changes (private repository)</li>
<li>Push your changes (private repository) <blockquote class="doxtable">
<p >&zwj;<b>Remeber to update SDK verison <a href="vitroio-sdk/version.h">here</a></b> </p>
</blockquote>
4. Merge to master (private repository)</li>
<li>Checkout locally on the origin/master and pull changes including merge commit (private repository)</li>
<li>Place a tag on the merge commit (private repository)</li>
<li>Push the tag with:</li>
</ol>
<div class="fragment"><div class="line">git push origin --tags</div>
</div><!-- fragment --><p >Pushing the tag will trigger the CI/CD pipeline.</p>
<p >The pipeline will compile the library, generate docs and push the changes to public repository on <code>cicd-from-private</code> branch.</p>
<ol type="1">
<li>Go to public repo on github checkout on <code>cicd-from-private</code> branch.</li>
<li>Create pull request, review changes and merge. </li>
</ol>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5 </li>
  </ul>
</div>
</body>
</html>
